<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Overview - PyO3 user guide</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="PyO3 user guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

        <!-- Custom JS script -->
        

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="./overview.html" class="active">Overview</a></li><li class="affix"><a href="./getting_started.html">Getting Started</a></li><li><a href="./conversions.html"><strong>1.</strong> Type Conversions</a></li><li><a href="./exception.html"><strong>2.</strong> Python Exception</a></li><li><a href="./module.html"><strong>3.</strong> Python Module</a></li><li><a href="./function.html"><strong>4.</strong> Python Function</a></li><li><a href="./class.html"><strong>5.</strong> Python Class</a></li><li><a href="./parallelism.html"><strong>6.</strong> Parallelism</a></li><li><a href="./distribution.html"><strong>7.</strong> Distribution</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title">PyO3 user guide</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./overview.html#overview" id="overview"><h1>Overview</h1></a>
<p><a href="https://travis-ci.org/PyO3/pyo3"><img src="https://travis-ci.org/PyO3/pyo3.svg?branch=master" alt="Build Status" /></a>
<a href="https://crates.io/crates/pyo3"><img src="https://img.shields.io/crates/v/pyo3.svg" alt="Latest Version" /></a>
<a href="http://pyo3.github.io/pyo3/pyo3/"><img src="https://img.shields.io/badge/api-rustdoc-blue.svg" alt="Rust Documentation" /></a></p>
<p>PyO3 is a <a href="http://www.rust-lang.org/">Rust</a> bindings for the <a href="https://www.python.org/">Python</a> interpreter.</p>
<p>Supported Python versions:</p>
<ul>
<li>Python2.7, Python 3.5 and up</li>
</ul>
<p>Supported Rust version:</p>
<ul>
<li>Rust 1.20.0-nightly or later</li>
<li>On Windows, we require rustc 1.20.0-nightly</li>
</ul>
<a class="header" href="./overview.html#usage" id="usage"><h2>Usage</h2></a>
<p>To use <code>pyo3</code>, add this to your <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[dependencies]
pyo3 = &quot;0.2&quot;
</code></pre>
<p>Example program displaying the value of <code>sys.version</code>:</p>
<pre><pre class="playpen"><code class="language-rust">extern crate pyo3;

use pyo3::{Python, PyDict, PyResult};

fn main() {
    let gil = Python::acquire_gil();
    hello(gil.python()).unwrap();
}

fn hello(py: Python) -&gt; PyResult&lt;()&gt; {
    let sys = py.import(&quot;sys&quot;)?;
    let version: String = sys.get(&quot;version&quot;)?.extract()?;

    let locals = PyDict::new(py);
    locals.set_item(&quot;os&quot;, py.import(&quot;os&quot;)?)?;
    let user: String = py.eval(&quot;os.getenv('USER') or os.getenv('USERNAME')&quot;, None, Some(&amp;locals))?.extract()?;

    println!(&quot;Hello {}, I'm Python {}&quot;, user, version);
    Ok(())
}
</code></pre></pre>
<p>Example library with python bindings:</p>
<p>The following two files will build with <code>cargo build</code>, and will generate a python-compatible library.
On macOS, you will need to rename the output from *.dylib to *.so.
On Windows, you will need to rename the output from *.dll to *.pyd.</p>
<p><strong><code>Cargo.toml</code>:</strong></p>
<pre><code class="language-toml">[lib]
name = &quot;rust2py&quot;
crate-type = [&quot;cdylib&quot;]

[dependencies.pyo3]
version = &quot;0.1&quot;
features = [&quot;extension-module&quot;]
</code></pre>
<p><strong><code>src/lib.rs</code></strong></p>
<pre><pre class="playpen"><code class="language-rust">#![feature(proc_macro, specialization)]

extern crate pyo3;
use pyo3::{py, PyResult, Python, PyModule};

// add bindings to the generated python module
// N.B: names: &quot;librust2py&quot; must be the name of the `.so` or `.pyd` file
/// This module is implemented in Rust.
#[py::modinit(rust2py)]
fn init_mod(py: Python, m: &amp;PyModule) -&gt; PyResult&lt;()&gt; {

    #[pyfn(m, &quot;sum_as_string&quot;)]
    // pyo3 aware function. All of our python interface could be declared in a separate module.
    // Note that the `#[pyfn()]` annotation automatically converts the arguments from
    // Python objects to Rust values; and the Rust return value back into a Python object.
    fn sum_as_string_py(_: Python, a:i64, b:i64) -&gt; PyResult&lt;String&gt; {
       let out = sum_as_string(a, b);
       Ok(out)
    }

    Ok(())
}

// logic implemented as a normal rust function
fn sum_as_string(a:i64, b:i64) -&gt; String {
    format!(&quot;{}&quot;, a + b).to_string()
}

# fn main() {}
</code></pre></pre>
<p>For <code>setup.py</code> integration, see <a href="https://github.com/PyO3/setuptools-rust">setuptools-rust</a></p>
<a class="header" href="./overview.html#ownership-and-lifetimes" id="ownership-and-lifetimes"><h2>Ownership and Lifetimes</h2></a>
<p>In Python, all objects are implicitly reference counted.
In Rust, we will use the <a href="https://pyo3.github.io/pyo3/pyo3/struct.PyObject.html"><code>PyObject</code></a> type
to represent a reference to a Python object.</p>
<p>Because all Python objects potentially have multiple owners, the
concept of Rust mutability does not apply to Python objects.
As a result, this API will <strong>allow mutating Python objects even if they are not stored
in a mutable Rust variable</strong>.</p>
<p>The Python interpreter uses a global interpreter lock (GIL) to ensure thread-safety.
This API uses a zero-sized <a href="https://pyo3.github.io/PyO3/pyo3/struct.Python.html"><code>struct Python&lt;'p&gt;</code></a> as a token to indicate
that a function can assume that the GIL is held.</p>
<p>You obtain a <a href="https://pyo3.github.io/PyO3/pyo3/struct.Python.html"><code>Python</code></a> instance
by acquiring the GIL, and have to pass it into some operations that call into the Python runtime.</p>
<p>PyO3 library provides wrappers for python native objects. Ownership of python objects are
disallowed because any access to python runtime has to be protected by GIL.
All apis are available through references. Lifetimes of python object's refereces are
bound to GIL lifetime.</p>
<p>There are two types of pointers that could be stored on rust structs.
Both implements <code>Send</code> and <code>Sync</code> traits and maintain python object's reference count.</p>
<ul>
<li>
<p><a href="https://pyo3.github.io/pyo3/pyo3/struct.PyObject.html"><code>PyObject</code></a> is general purpose
type. It does not maintain type of the referenced object. It provides helper methods
for extracing rust values and casting to specific python object type.</p>
</li>
<li>
<p><a href="https://pyo3.github.io/pyo3/pyo3/struct.Py.html"><code>Py&lt;T&gt;</code></a> represents a reference to a
concrete python object <code>T</code>.</p>
</li>
</ul>
<p>To upgrade to a reference <a href="https://pyo3.github.io/pyo3/pyo3/trait.AsPyRef.html"><code>AsPyRef</code></a>
trait can be used.</p>

                </div>

                <!-- Mobile navigation buttons -->
                

                
                    <a rel="next" href="./getting_started.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            

            
                <a href="./getting_started.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>